<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>历史设施</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link href="../css/mui.min.css" rel="stylesheet">
		<script src="../js/mui.min.js"></script>

		<link rel="stylesheet" type="text/css" href="../css/base.css" />
		<script src="../js/base.js" type="text/javascript" charset="utf-8"></script>

	</head>

	<body>

		<div class="mui-content">
			<div id="slider" class="mui-slider">
				<div id="sliderSegmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<a class="mui-control-item" href="#item1mobile">已暂存</a>
					<a class="mui-control-item" href="#item2mobile">已提交</a>
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
				<div class="mui-slider-group">
					<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="scroll1" class="mui-scroll-wrapper">
							<!--下拉刷新容器-->
							<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
								<div class="mui-scroll">
									<!--数据列表-->
									<ul class="mui-table-view mui-table-view-chevron">

									</ul>
								</div>
							</div>
						</div>
					</div>
					<div id="item2mobile" class="mui-slider-item mui-control-content">
						<div id="scroll2" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div class="mui-loading">
									<div class="mui-spinner">
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>

		<script src="../js/jquery-1.11.2.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script>
			mui.init({
				swipeBack: false,
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: function() {
							mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
						}
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});

			function showWindow(id, url, recid) {
				mui.openWindow({
					id: id,
					url: url,
					show: {
						autoshow: true,
						aniShow: 'slide-in-right'
					},
					waiting: {
						autoshow: false
					},
					extras: {
						recid: recid
					}
				})
			}
			var slideType = 0;
			var total = 0; //总个数
			var pageNo = 0; //当前页数
			var pageSize = 20; //显示多少个
			var count = 0;
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					var table = document.body.querySelector('.mui-table-view');
					var cells = document.body.querySelectorAll('.mui-table-view-cell');
					mui.ajax(localhost + "walk/service/appInfoService/searchAppInfo?pageNo=" + pageNo + "&pageSize=" + pageSize, {
						dataType: 'json', //服务器返回json格式数据
						type: 'get', //HTTP请求类型
						timeout: 15000, //超时时间设置为10秒；
						success: function(result) {
							//服务器返回响应，根据响应结果，分析是否登录成功；
							if (result.success) {
								var data = result.data;
								var rows = data.rows;
								var pageIndex = pageNo * pageSize;
								if (rows.length > 0) {
									for (var i = 0; i < rows.length; i++) {
										var evalContent = rows[i].EVALCONTENT;
										var address = rows[i].ADDRESS;
										var uploadtime = rows[i].UPLOADTIME;
										var evaltype = rows[i].EVALTYPE;
										var id = rows[i].ID;
										var longitude = rows[i].LONGITUDE;
										var filedpath = rows[i].FILEDPATH;
										var statu = rows[i].STATU;
										var latitude = rows[i].LATITUDE;
										var userid = rows[i].USERID;
										var li = document.createElement('li');
										li.className = 'mui-table-view-cell mui-mmui-media';
										li.innerHTML = '<a class="mui-navigate-right" onclick="showWindow(\'facilities-update-history-info\',\'facilities-update-history-info.html\',\'' + id + '\')">' + '  <img class="mui-media-object mui-pull-left" src="../images/cbd.jpg">' + '	<div class="mui-media-body">' + '		<div style="float:left;">井盖掉了' + (pageIndex += 1) + '</div><h6>' + uploadtime + '</h6>' + '		<p class="mui-ellipsis">顺义区马坡镇XX路下水道井盖掉了...</p>' + '	</div>' + '</a>'
										table.appendChild(li);
									}
									mui('#pullrefresh').pullRefresh().endPullupToRefresh(); //refresh completed
								} else {
									mui('#pullrefresh').pullRefresh().endPullupToRefresh(true); //参数为true代表没有更多数据了。
								}
								pageNo++;
							} else {
								alert("服务异常，请稍后再试！");
							}
						},
						error: function(xhr, type, errorThrown) {
							//异常处理；
							console.log(type);
							alert("服务异常，请稍后再试！");
						}
					});
				}, 800);
			}
			if (mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 200);
				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
			(function($) {
				//var html2 = '<div id="pullrefresh2" class="mui-content mui-scroll-wrapper"><div class="mui-scroll"><ul class="mui-table-view mui-table-view-chevron">asdf</ul></div></div>';
				var html2 = '<ul class="mui-table-view"><li class="mui-table-view-cell">第三个选项卡子项-1</li><li class="mui-table-view-cell">第三个选项卡子项-2</li><li class="mui-table-view-cell">第三个选项卡子项-3</li><li class="mui-table-view-cell">第三个选项卡子项-4</li><li class="mui-table-view-cell">第三个选项卡子项-5</li></ul>';
				var item2 = document.getElementById('item2mobile');
				document.getElementById('slider').addEventListener('slide', function(e) {
					if (e.detail.slideNumber === 0) {
						document.getElementById('scroll1').style.display = 'block';
						document.getElementById('scroll2').style.display = 'none';
					}
					if (e.detail.slideNumber === 1) {
						document.getElementById('scroll2').style.display = 'block';
						document.getElementById('scroll1').style.display = 'none';
						if (item2.querySelector('.mui-loading')) {
							setTimeout(function() {
								item2.querySelector('.mui-scroll').innerHTML = html2;
							}, 200);
						}
					}
				});
				var sliderSegmentedControl = document.getElementById('sliderSegmentedControl');
				$('.mui-input-group').on('change', 'input', function() {
					if (this.checked) {
						sliderSegmentedControl.className = 'mui-slider-indicator mui-segmented-control mui-segmented-control-inverted mui-segmented-control-' + this.value;
						//force repaint
						sliderProgressBar.setAttribute('style', sliderProgressBar.getAttribute('style'));
					}
				});
			})(mui);
		</script>

	</body>

</html>