
<title>首页 - 步行出行环境评价应用系统</title>

<!-- ajax layout which only needs content area -->
<div class="page-header">
	<h1>
		首页
		<small>
			<i class="ace-icon fa fa-angle-double-right"></i>
			首页
		</small>
	</h1>
</div>
<!-- /.page-header -->

<div class="row">
	<div class="col-xs-12">
		<!-- PAGE CONTENT BEGINS -->
		<div class="alert alert-block alert-success">
			<button type="button" class="close" data-dismiss="alert">
				<i class="ace-icon fa fa-times"></i>
			</button>

			<i class="ace-icon fa fa-check green"></i>

			欢迎登录步行出行环境评价应用系统
		</div>

		<div class="row">
			<div class="space-6"></div>

			<div class="col-sm-7 infobox-container">
				<!-- #section:pages/dashboard.infobox -->
				<div class="infobox infobox-green">
					<div class="infobox-chart">
						<span class="sparkline" data-values="196,128,202,177,154,94,100,170,224"></span>
					</div>

					<div class="infobox-data">
						<span class="infobox-data-number" id="dataCount1">32</span>
						<div class="infobox-content">路径评价提交量</div>
					</div>

					<!-- #section:pages/dashboard.infobox.stat -->
					<div class="stat stat-success">+11%</div>

					<!-- /section:pages/dashboard.infobox.stat -->
				</div>

				<div class="infobox infobox-blue">
					<div class="infobox-chart">
						<span class="sparkline" data-values="196,128,202,177,154,94,100,170,224"></span>
					</div>

					<div class="infobox-data">
						<span class="infobox-data-number" id="dataCount2">0</span>
						<div class="infobox-content">设施评价提交量</div>
					</div>

					<div class="stat stat-success">+8%</div>
				</div>

				<div class="infobox infobox-pink">
					<div class="infobox-chart">
						<span class="sparkline" data-values="196,128,202,177,154,94,100,170,224"></span>
					</div>

					<div class="infobox-data">
						<span class="infobox-data-number" id="dataCount3">0</span>
						<div class="infobox-content">设施信息提交量</div>
					</div>
					<div class="stat stat-success">+16%</div>
				</div>

				<div class="space-6"></div>

				<div class="infobox infobox-red">
					<div class="infobox-icon">
						<i class="ace-icon fa fa-flask"></i>
					</div>

					<div class="infobox-data">
						<span class="infobox-data-number" id="dataCount4">0</span>
						<div class="infobox-content">今日新增</div>
					</div>
				</div>

				<div class="infobox infobox-orange2">
					<!-- #section:pages/dashboard.infobox.sparkline -->
					<div class="infobox-chart">
						<span class="sparkline" data-values="196,128,202,177,154,94,100,170,224"></span>
					</div>

					<!-- /section:pages/dashboard.infobox.sparkline -->
					<div class="infobox-data">
						<span class="infobox-data-number" id="dataCount5">0</span>
						<div class="infobox-content">总提交量</div>
					</div>

					<div class="badge badge-success">
						12%
						<i class="ace-icon fa fa-arrow-up"></i>
					</div>
				</div>

				<!-- /section:pages/dashboard.infobox -->
				<div class="space-6"></div>


				<div class="infobox infobox-blue infobox-small infobox-dark">
					<!-- #section:pages/dashboard.infobox.sparkline -->
					<div class="infobox-chart">
						<span class="sparkline" data-values="3,4,2,3,4,4,2,2"></span>
					</div>

					<!-- /section:pages/dashboard.infobox.sparkline -->
					<div class="infobox-data">
						<div class="infobox-content">用户数</div>
						<div class="infobox-content" id="dataCount6">0</div>
					</div>
				</div>

				<div class="infobox infobox-grey infobox-small infobox-dark">
					<div class="infobox-chart">
						<span class="sparkline" data-values="3,4,2,3,4,4,2,2"></span>
					</div>

					<div class="infobox-data">
						<div class="infobox-content">访问统计</div>
						<div class="infobox-content" id="dataCount7">323次</div>
					</div>
				</div>

				<!-- /section:pages/dashboard.infobox.dark -->
			</div>

			<div class="vspace-12-sm"></div>

			<div class="col-sm-5">
				<div class="widget-box">
					<div class="widget-header widget-header-flat widget-header-small">
						<h5 class="widget-title">
							<i class="ace-icon fa fa-signal"></i>
							设施评价问题类型占比
						</h5>

					</div>

					<div class="widget-body">
						<div class="widget-main">
							<!-- #section:plugins/charts.flotchart -->
							<div id="piechart-placeholder"></div>

							<!-- /section:plugins/charts.flotchart -->

						</div>
						<!-- /.widget-main -->
					</div>
					<!-- /.widget-body -->
				</div>
				<!-- /.widget-box -->
			</div>
			<!-- /.col -->
		</div>
		<!-- /.row -->

		<!-- #section:custom/extra.hr -->
		<div class="hr hr32 hr-dotted"></div>

		<!-- /section:custom/extra.hr -->
		<div class="row">
			<div class="col-sm-7">
				<div class="widget-box transparent">
					<div class="widget-header widget-header-flat">
						<h4 class="widget-title lighter">
							<i class="ace-icon fa fa-star orange"></i>
							最新提交
						</h4>

						<div class="widget-toolbar">
							<a href="#" data-action="collapse">
								<i class="ace-icon fa fa-chevron-up"></i>
							</a>
						</div>
					</div>

					<div class="widget-body">
						<div class="widget-main no-padding">
							<table class="table table-bordered table-striped">
								<thead class="thin-border-bottom">
									<tr>
										<th class="col-sm-4">
											<i class="ace-icon fa fa-caret-right blue"></i>
											提交人
										</th>

										<th class="col-sm-4">
											<i class="ace-icon fa fa-caret-right blue"></i>
											提交评价类型
										</th>

										<th class="col-sm-4 hidden-480">
											<i class="ace-icon fa fa-caret-right blue"></i>
											提交时间
										</th>
									</tr>
								</thead>

								<tbody>
									<tr>
										<td>张三</td>

										<td class="hidden-480">
											<span class="label label-info arrowed-right arrowed-in">on sale</span>
										</td>

										<td>
											<b class="green">2015-04-01 12:50:54</b>
										</td>

									</tr>

									<tr>
										<td>张三</td>

										<td class="hidden-480">
											<span class="label label-success arrowed-in arrowed-in-right">approved</span>
										</td>

										<td>
											<b class="green">2015-04-01 12:38:23</b>
										</td>

									</tr>

									<tr>
										<td>aa</td>

										<td class="hidden-480">
											<span class="label label-danger arrowed">pending</span>
										</td>

										<td>
											<b class="green">2015-04-01 10:23:19</b>
										</td>

									</tr>

									<tr>
										<td>lll</td>

										<td class="hidden-480">
											<span class="label arrowed">
												<s>out of stock</s>
											</span>
										</td>

										<td>
											<b class="green">2015-04-01 10:16:23</b>
										</td>

									</tr>

									<tr>
										<td>张三</td>

										<td class="hidden-480">
											<span class="label label-warning arrowed arrowed-right">SOLD</span>
										</td>

										<td>
											<b class="green">2015-04-01 08:50:28</b>
										</td>

									</tr>
								</tbody>
							</table>
						</div>
						<!-- /.widget-main -->
					</div>
					<!-- /.widget-body -->
				</div>
				<!-- /.widget-box -->
			</div>
			<!-- /.col -->

			<div class="col-sm-5">
				<div class="widget-box">
					<div class="widget-header widget-header-flat widget-header-small">
						<h5 class="widget-title">
							<i class="ace-icon fa fa-signal"></i>
							设施更新信息类型占比
						</h5>

					</div>

					<div class="widget-body">
						<div class="widget-main">
							<!-- #section:plugins/charts.flotchart -->
							<div id="piechart-placeholder1"></div>

							<!-- /section:plugins/charts.flotchart -->

						</div>
						<!-- /.widget-main -->
					</div>
					<!-- /.widget-body -->
				</div>
				<!-- /.widget-box -->
			</div>
			<!-- /.col -->
		</div>
		<!-- /.row -->

		<div class="hr hr32 hr-dotted"></div>


		<!-- PAGE CONTENT ENDS -->
	</div>
	<!-- /.col -->
</div>
<!-- /.row -->

<!-- page specific plugin scripts -->

<!--[if lte IE 8]>
  <script src="../../assets/js/excanvas.js"></script>
<![endif]-->
<script type="text/javascript">
	var scripts = [ null, "../../assets/js/jquery-ui.custom.js", "../../assets/js/jquery.ui.touch-punch.js", "../../assets/js/jquery.easypiechart.js", "../../assets/js/jquery.sparkline.js", "../../assets/js/flot/jquery.flot.js", "../../assets/js/flot/jquery.flot.pie.js", "../../assets/js/flot/jquery.flot.resize.js", null ]
	$('.page-content-area').ace_ajax('loadScripts', scripts, function() {
		//inline scripts related to this page
		jQuery(function($) {
			var sumCount=0;
			$.ajax("/walk/service/appPathService/getAppPathsCount", {
				dataType : 'json', //服务器返回json格式数据
				type : 'GET', //HTTP请求类型
				timeout : 15000, //超时时间设置为15秒；
				success : function(result) {
					if (result.success) {
						$("#dataCount1").html(result.data.COUNT);
						sumCount+=result.data.COUNT;
						$("#dataCount5").html(sumCount);
					} else {
						alert("服务异常，请稍后再试！");
					}
				},
				error : function(xhr, type, errorThrown) {
					//异常处理；
					alert("服务异常，请稍后再试！");
				}
			});
			$.ajax("/walk/service/appEvaluationService/getAppEvaluationsCount", {
				dataType : 'json', //服务器返回json格式数据
				type : 'GET', //HTTP请求类型
				timeout : 15000, //超时时间设置为15秒；
				success : function(result) {
					if (result.success) {
						$("#dataCount2").html(result.data.COUNT);
						sumCount+=result.data.COUNT;
						$("#dataCount5").html(sumCount);
					} else {
						alert("服务异常，请稍后再试！");
					}
				},
				error : function(xhr, type, errorThrown) {
					//异常处理；
					alert("服务异常，请稍后再试！");
				}
			});
			$.ajax("/walk/service/appInfoService/getAppInfosCount", {
				dataType : 'json', //服务器返回json格式数据
				type : 'GET', //HTTP请求类型
				timeout : 15000, //超时时间设置为15秒；
				success : function(result) {
					if (result.success) {
						$("#dataCount3").html(result.data.COUNT);
						sumCount+=result.data.COUNT;
						$("#dataCount5").html(sumCount);
					} else {
						alert("服务异常，请稍后再试！");
					}
				},
				error : function(xhr, type, errorThrown) {
					//异常处理；
					alert("服务异常，请稍后再试！");
				}
			});
			$.ajax("/walk/service/appUserService/getAppUsersCount", {
				dataType : 'json', //服务器返回json格式数据
				type : 'GET', //HTTP请求类型
				timeout : 15000, //超时时间设置为15秒；
				success : function(result) {
					if (result.success) {
						$("#dataCount6").html(result.data.COUNT);
					} else {
						alert("服务异常，请稍后再试！");
					}
				},
				error : function(xhr, type, errorThrown) {
					//异常处理；
					alert("服务异常，请稍后再试！");
				}
			});

			$('.easy-pie-chart.percentage').each(function() {
				var $box = $(this).closest('.infobox');
				var barColor = $(this).data('color') || (!$box.hasClass('infobox-dark') ? $box.css('color') : 'rgba(255,255,255,0.95)');
				var trackColor = barColor == 'rgba(255,255,255,0.95)' ? 'rgba(255,255,255,0.25)' : '#E2E2E2';
				var size = parseInt($(this).data('size')) || 50;
				$(this).easyPieChart({
					barColor : barColor,
					trackColor : trackColor,
					scaleColor : false,
					lineCap : 'butt',
					lineWidth : parseInt(size / 10),
					animate : /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase()) ? false : 1000,
					size : size
				});
			})

			$('.sparkline').each(function() {
				var $box = $(this).closest('.infobox');
				var barColor = !$box.hasClass('infobox-dark') ? $box.css('color') : '#FFF';
				$(this).sparkline('html', {
					tagValuesAttribute : 'data-values',
					type : 'bar',
					barColor : barColor,
					chartRangeMin : $(this).data('min') || 0
				});
			});

			//flot chart resize plugin, somehow manipulates default browser resize event to optimize it!
			//but sometimes it brings up errors with normal resize event handlers
			$.resize.throttleWindow = false;

			var placeholder = $('#piechart-placeholder').css({
				'width' : '86%',
				'min-height' : '180px'
			});
			var data = [ {
				label : "人行道宽度窄",
				data : 38.7,
				color : "#68BC31"
			}, {
				label : "人行道无盲道",
				data : 24.5,
				color : "#2091CF"
			}, {
				label : "盲道有障碍物",
				data : 8.2,
				color : "#AF4E96"
			}, {
				label : "绿化环境差",
				data : 18.6,
				color : "#DA5430"
			}, {
				label : "其他",
				data : 10,
				color : "#FEE074"
			} ]
			var placeholder1 = $('#piechart-placeholder1').css({
				'width' : '86%',
				'min-height' : '210px'
			});
			var data1 = [ {
				label : "人行跨路桥",
				data : 38.7,
				color : "#68BC31"
			}, {
				label : "照明设施",
				data : 24.5,
				color : "#2091CF"
			}, {
				label : "停车场",
				data : 8.2,
				color : "#AF4E96"
			}, {
				label : "公共汽车停靠站",
				data : 18.6,
				color : "#DA5430"
			}, {
				label : "栅栏",
				data : 10,
				color : "#FEE074"
			} ]
			function drawPieChart(placeholder, data, position) {
				$.plot(placeholder, data, {
					series : {
						pie : {
							show : true,
							tilt : 0.8,
							highlight : {
								opacity : 0.25
							},
							stroke : {
								color : '#fff',
								width : 2
							},
							startAngle : 2
						}
					},
					legend : {
						show : true,
						position : position || "ne",
						labelBoxBorderColor : null,
						margin : [ -30, 15 ]
					},
					grid : {
						hoverable : true,
						clickable : true
					}
				})
			}
			drawPieChart(placeholder, data);
			drawPieChart(placeholder1, data1);
			/**
			we saved the drawing function and the data to redraw with different position later when switching to RTL mode dynamically
			so that's not needed actually.
			 */
			placeholder.data('chart', data);
			placeholder.data('draw', drawPieChart);

			//pie chart tooltip example
			var $tooltip = $("<div class='tooltip top in'><div class='tooltip-inner'></div></div>").hide().appendTo('body');
			var previousPoint = null;

			placeholder.on('plothover', function(event, pos, item) {
				if (item) {
					if (previousPoint != item.seriesIndex) {
						previousPoint = item.seriesIndex;
						var tip = item.series['label'] + " : " + item.series['percent'] + '%';
						$tooltip.show().children(0).text(tip);
					}
					$tooltip.css({
						top : pos.pageY + 10,
						left : pos.pageX + 10
					});
				} else {
					$tooltip.hide();
					previousPoint = null;
				}

			});

			/////////////////////////////////////
			$(document).one('ajaxloadstart.page', function(e) {
				$tooltip.remove();
			});

			var d1 = [];
			for ( var i = 0; i < Math.PI * 2; i += 0.5) {
				d1.push([ i, Math.sin(i) ]);
			}

			var d2 = [];
			for ( var i = 0; i < Math.PI * 2; i += 0.5) {
				d2.push([ i, Math.cos(i) ]);
			}

			var d3 = [];
			for ( var i = 0; i < Math.PI * 2; i += 0.2) {
				d3.push([ i, Math.tan(i) ]);
			}

			$('#recent-box [data-rel="tooltip"]').tooltip({
				placement : tooltip_placement
			});
			function tooltip_placement(context, source) {
				var $source = $(source);
				var $parent = $source.closest('.tab-content')
				var off1 = $parent.offset();
				var w1 = $parent.width();

				var off2 = $source.offset();
				//var w2 = $source.width();

				if (parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2))
					return 'right';
				return 'left';
			}

			$('.dialogs,.comments').ace_scroll({
				size : 300
			});

			//Android's default browser somehow is confused when tapping on label which will lead to dragging the task
			//so disable dragging when clicking on label
			var agent = navigator.userAgent.toLowerCase();
			if ("ontouchstart" in document && /applewebkit/.test(agent) && /android/.test(agent))
				$('#tasks').on('touchstart', function(e) {
					var li = $(e.target).closest('#tasks li');
					if (li.length == 0)
						return;
					var label = li.find('label.inline').get(0);
					if (label == e.target || $.contains(label, e.target))
						e.stopImmediatePropagation();
				});

			$('#tasks').sortable({
				opacity : 0.8,
				revert : true,
				forceHelperSize : true,
				placeholder : 'draggable-placeholder',
				forcePlaceholderSize : true,
				tolerance : 'pointer',
				stop : function(event, ui) {
					//just for Chrome!!!! so that dropdowns on items don't appear below other items after being moved
					$(ui.item).css('z-index', 'auto');
				}
			});
			$('#tasks').disableSelection();
			$('#tasks input:checkbox').removeAttr('checked').on('click', function() {
				if (this.checked)
					$(this).closest('li').addClass('selected');
				else
					$(this).closest('li').removeClass('selected');
			});

			//show the dropdowns on top or bottom depending on window height and menu position
			$('#task-tab .dropdown-hover').on('mouseenter', function(e) {
				var offset = $(this).offset();

				var $w = $(window)
				if (offset.top > $w.scrollTop() + $w.innerHeight() - 100)
					$(this).addClass('dropup');
				else
					$(this).removeClass('dropup');
			});

		})

	});
</script>
